[gcode_macro M106]
description: Set Fan Speed. P0 for part, P2 for auxiliary, P3 chamber
gcode:
  {% set fan_map = {0: "Part_Fan", 2: "Side_Fan", 3: "exhaust_fan"} %}
  {% set fan_id = params.P|default(0)|int %}
  {% set fan = fan_map[fan_id] %}
  {% set speed_param = params.S|default(255)|int %}
  {% if speed_param > 0 %}
    {% set speed = (speed_param|float / 255) %}
  {% else %}
    {% set speed = 0 %}
  {% endif %}
  SET_FAN_SPEED FAN={fan} SPEED={speed}

[gcode_macro M107]
description: Set Fan Off. P0 for part, P2 for auxiliary, P3 chamber
gcode:
  {% set fan_map = {0: "Part_Fan", 2: "Side_Fan", 3: "exhaust_fan"} %}
  {% set fan_id = params.P|default(0)|int %}
  {% set fan = fan_map[fan_id] %}
  SET_FAN_SPEED FAN={fan} SPEED=0